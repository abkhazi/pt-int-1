# Отчет о Проделанной Работе

## Задача

Решить ряд задач по тестированию взаимодействия с базой данных MySQL с использованием библиотеки pytest.

## Выполненные задачи

1. Написаны функциональные тесты на запросы SELECT с использованием оператора LIKE.
2. Разработаны тесты производительности для проверки эффективности запросов с и без использования индексов.
3. Реализованы тесты на проверку отсутствия использования индексов при выполнении запросов.

## Подготовка окружения

Проведение тестов проводилось на  базе данных MySql, установленной на виртуальной машине Ubuntu - Server version: 8.0.36-0ubuntu0.22.04.1 (Ubuntu). Версия Python - Python 3.10.12

Необходимо установить:

- Python 3
- pytest
- MySQL
- mysql-connector-python

### Подготовка базы данных

#### Создание БД

```sql
CREATE DATABASE test_db;
```
#### Создание таблицы
```sql
CREATE TABLE test_table (
    id INT AUTO_INCREMENT PRIMARY KEY,
    employee VARCHAR(255),
    department VARCHAR(255)
);
```
Создание пользователя **test_user** и назначение ему прав:
```sql
CREATE DATABASE test_db;

CREATE USER 'test_user'@'localhost' IDENTIFIED BY 'password';

GRANT ALL PRIVILEGES ON test_db.* TO 'test_user'@'localhost';

FLUSH PRIVILEGES;

EXIT;
```
## Описание проделанной работы
Тесты реализованы в виде трех python скриптов:

- Функциональный тест на SELECT str like pattern - **test_functional_mysql.py**

- Перфоманс тест SELECT str like pattern - **test_perfomance_mysql.py**

- Тест на поиск случая, когда индекс не будет использоваться - **test_index_usage_mysql.py**

### Запуск тестов

В каждом тесте релизовано подключение к БД а также удаление старых данных и заполнение новыми, это сделано для удобства, так как позволяет отдельно запускать тест в любом порядке и количестов данных не большое.

### Функциональный тест

В теcте написана функция **test_select_like_without_index(db_connection)**. Это функция-тест, которая проверяет результаты запросов SELECT с использованием и без использования индекса. Сначала она заполняет таблицу данными с помощью функции *populate_table()*. Затем она выполняет запрос SELECT без индекса, сохраняет результаты (когда мы выполняем запрос с помощью метода *cursor.fetchall()*, результаты запроса извлекаются из курсора и сохраняются в виде списка кортежей, каждый кортеж представляет одну строку результата запроса). Далее создает индекс на столбце employee. После этого она выполняет тот же запрос SELECT с индексом и сравнивает результаты с первым запросом, чтобы убедиться, что они совпадают.

Ключевая часть этого теста заключается в проверке совпадения результатов запросов SELECT с использованием и без использования индекса. Если результаты отличаются, тест не пройдет.

1. Сначала таблица заполняется данными с помощью функции populate_table().
2. Затем выполняется запрос SELECT без индекса и сохраняются результаты.
3. Создается индекс на столбце employee.
4. Выполняется тот же запрос SELECT с индексом.
5. Сравниваются результаты двух запросов, чтобы убедиться, что они совпадают.

### Перфоманс тест

Тестовый метод **test_performance_select_like** выполняет два типа запросов SELECT: один без индекса и один с индексом. Он измеряет время выполнения каждого запроса и сравнивает их между собой. Ожидается, что запрос с индексом будет выполняться быстрее. Выводится также результат выполнения объяснительного запроса EXPLAIN для отслеживания использования индекса. В данном тесте важно учитывать кеш который хранит БД и количесво записей. Так на малом количестве записей, использование индекса уступает методу без индекса, поэтому тут генерируется больше записей. Также здесь дополнительно написана фиксутра для удаления кеша.

1. Измеряется время выполнения каждого запроса и сравнивается между собой.
2. Ожидается, что запрос с индексом будет выполняться быстрее.
3. Выводится результат выполнения объяснительного запроса EXPLAIN для отслеживания использования индекса.

### Тест на поиск случая, когда индекс не будет использоваться

Код выполняет тестирование работы индексов в MySQL базе данных, используя фреймворк pytest. Он проверяет, что индекс не используется в запросах, которые применяют оператор LIKE с подстановочными символами и функцию UPPER.

Тест **test_index_not_used_with_like** - проверяет, что индекс не используется в запросе с оператором LIKE, если подстановочные символы находятся в начале и в конце строки.

Тест **test_index_not_used_with_upper** - проверяет, что индекс не используется в запросе, если функция UPPER применяется к колонке, и оператор LIKE используется для фильтрации.

## Заключение
Все задачи решены и тесты прошли успешно. Благодаря использованию фреймворка pytest удалось эффективно организовать тестирование взаимодействия с базой данных MySQL.